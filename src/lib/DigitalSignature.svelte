<script context="module">
  export let sig;
  export const rsaPrivateKey = `-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
`;

  export let publicKey;

  export const validateText = (text, sigValueHex) => {
    console.log("validating: ");
    console.log("text: ", text);
    console.log("sigValueHex: ", sigValueHex);
    //     sig.init(
    //       KEYUTIL.getKey(`-----BEGIN PUBLIC KEY-----
    // MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDJ4MSVwWfTDahGb/q9Zy4kMTic
    // AIBmAODiLwqLBcLiZIcVfe+sx21hyB/rsKrjXotrzfL8SI1dhF4jlS9crzqdFfsb
    // BIqu5XTrZQamoHNFRbbb1XW0FStt1ilYGY/o6742/WHvlEjC1Q3QhxCsOWknASjP
    // T/VxIRXFqNdb6aEkLQIDAQAB
    // -----END PUBLIC KEY-----`)
    //     ); // rsaPrivateKey of RSAKey object
    sig.init(`-----BEGIN CERTIFICATE-----
MIIEMjCCApoCCQDas7aVwFPmbzANBgkqhkiG9w0BAQsFADBbMQswCQYDVQQGEwJD
WjEPMA0GA1UEBwwGUHJhZ3VlMRYwFAYDVQQDDA1QZXRyIEtsZXBldGtvMSMwIQYJ
KoZIhvcNAQkBFhRrbGVwZXRrb3BlQGdtYWlsLmNvbTAeFw0yMzA2MTkwNzAyMzFa
Fw0yNDA2MTMwNzAyMzFaMFsxCzAJBgNVBAYTAkNaMQ8wDQYDVQQHDAZQcmFndWUx
FjAUBgNVBAMMDVBldHIgS2xlcGV0a28xIzAhBgkqhkiG9w0BCQEWFGtsZXBldGtv
cGVAZ21haWwuY29tMIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAm2Ik
Ptba/MfK1FYGyD2gNghDRjLx0+tUxX6i5vtjJCefLj/agLxZKnITc/BANjhoPPg0
/rBc7Nn0dvkK+OiqqUEl+sNk4Ax5+62cbdBQNGoCdPzWtN7LBym8k249y/nHW3Xh
nrZ21x1i/1TRDjUL5OoElImXe/Mw/1KsWuToehTw9uA5jnO/4Ci9mrT5yi5+Io1D
2wUO1lIVAIV2SHLf07cABWMDJqNk6jE7TKzJ9oL6+qaw02N7nt7ArtLFmkwHnxB4
+h2EwK0dYtQ6CJ3/dNUbkh/9oqh5OXrKVbAdkzrkFohFfs6xM3xrJXbhklLq0Kh8
LqwPoEzrHEvPvqJWiYqSU6WUnDnexnQ67sjJLuJCHp7stUGWIipRUGWUvrMiOsAM
cAlm4Rd33vwcl27g67/1jrY020n9u1ypmlZr5dCXL41YKj2b2s9lXZ7cJvvhsdBL
BRkt7iHgXOB68sRLPpMdsEXb8dRoaErYRur24/DE8Cw2Rfcdp5GkSOtVSMoTAgMB
AAEwDQYJKoZIhvcNAQELBQADggGBABfaWwTJrn3iDzLCc/hi1gd13BnGhtyR9u0c
fN4xsJbAqJM5pQFCADNGeMsozrQpQbDYxo+1uHXS/A0H52V835VzKEfgemx2Kmdu
EznRj2m9I+QDCToqLBbaMbBtxHqyJozjCCVSl9IM6uA91Fi2+H7YeuDfM+KU7pEM
lvIVe7rJej1Xq6UzQiUhFpwA6us2QtDwxHhuqRSZdFo8bGux2NnRQzEPsVkThZh3
huXzUcPiOHc9WMh8W+y0uCfx4zfxo/xaEzQylh6Aosq8aHv8/ScxMCma9s7k0VPM
s5C3GIPTsa+0zQ21OZ26sxfNCFaHq6NzH682EIJOOukEknkU1D37j522dtev5TNI
dd/547PE5l0Qk1Xmb6ebCrtX2uOidGFwf39QHbeuO4MmUL5dHdDBJoMMN85d0Ny5
xa+WQ26LIneeRBZa0BMEIFvPgkCDTPxfRK94VByx9mWn3/JepmnXFaCs1KybMbfN
eGBuTNd+T9NUAn3lIxGFW9TzQKig8w==
-----END CERTIFICATE-----
`);
    //sig.updateString(text);
    return sig.verify(sigValueHex);
  };

  export const signText2 = (text) => {
    sig = new KJUR.crypto.Signature({ alg: "SHA1withRSA" });
    // initialize for signature generation
    sig.init(rsaPrivateKey);
    // sig.init(KEYUTIL.getKey(rsaPrivateKey)); //
    // update data
    sig.updateString(text);
    // calculate signature
    let sigValueHex = sig.sign();
    // console.log("sigValueHex: ", sigValueHex);
    console.log("auto overeni: ", validateText(text, sigValueHex));
    return sigValueHex;
  };
</script>

<script>
  import { onMount } from "svelte";

  onMount(() => {
    let script = document.createElement("script");
    script.src = "http://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js";
    document.head.append(script);

    script.onload = function () {
      publicKey = KEYUTIL.getKey(`-----BEGIN PUBLIC KEY-----
      MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIWvpMwu+1wZKeAk7jdpJl/qp39ofdyB
      LnaJD2+kBK8eSq14zxB3OtnlScq6dLzyKNYXgWxQaWQOuXUtX/lS2T0CAwEAAQ==
      -----END PUBLIC KEY-----`);
      // initialize
      sig = new KJUR.crypto.Signature({ alg: "SHA1withRSA" });
      // initialize for signature generation
      sig.init(KEYUTIL.getKey(rsaPrivateKey)); // rsaPrivateKey of RSAKey object
      console.log("Inicializov√°no");
    };
  });

  // update data
  // sig.updateString("aaa");
  // calculate signature
  // var sigValueHex = sig.sign();
</script>
